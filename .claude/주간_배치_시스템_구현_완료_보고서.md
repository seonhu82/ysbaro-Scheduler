# ì£¼ê°„ ë°°ì¹˜ ì‹œìŠ¤í…œ v2.0 êµ¬í˜„ ì™„ë£Œ ë³´ê³ ì„œ

**ì‘ì„±ì¼**: 2025-10-25
**ìƒíƒœ**: âœ… êµ¬í˜„ ì™„ë£Œ
**TypeScript ì˜¤ë¥˜**: 0ê±´

---

## ğŸ“‹ ìš”ì•½

ê¸°ì¡´ì˜ ì¼ë³„ ë°°ì¹˜ ì‹œìŠ¤í…œì„ **ì£¼ê°„ ë°°ì¹˜ ì‹œìŠ¤í…œ**ìœ¼ë¡œ ì™„ì „íˆ ì¬ì„¤ê³„í•˜ì—¬ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

### ì£¼ìš” ê°œì„ ì‚¬í•­

1. **ì£¼ ë‹¨ìœ„ ë°°ì¹˜ ë³´ì¥**: ì£¼4ì¼/ì£¼5ì¼ ê·¼ë¬´ ì§ì›ì˜ ìš”êµ¬ì¼ìˆ˜ë¥¼ ì£¼ì°¨ ë‹¨ìœ„ë¡œ ë³´ì¥
2. **í˜•í‰ì„± ì„¤ì • ê¸°ë°˜ ì ìš©**: ì•¼ê°„/ì£¼ë§/ê³µíœ´ì¼/ê³µíœ´ì¼ì „í›„ë¥¼ ì„¤ì •ì— ë”°ë¼ ì„ íƒì ìœ¼ë¡œ ì ìš©
3. **14ë‹¨ê³„ ë°°ì¹˜ í”„ë¡œì„¸ìŠ¤**: ì²´ê³„ì ì¸ ì¤€ë¹„-ë°°ì¹˜-ê²€ì¦-ì¡°ìœ¨-ê´€ë¦¬ í”„ë¡œì„¸ìŠ¤
4. **ë¯¸í•´ê²° ì´ìŠˆ ì¶”ì **: ì°¨ì£¼ ë°˜ì˜ì„ ìœ„í•œ ì´ìŠˆ ì¶”ì  ì‹œìŠ¤í…œ
5. **í˜•í‰ì„± ì ìˆ˜ ìë™ ì—…ë°ì´íŠ¸**: ë°°ì¹˜ ì™„ë£Œ í›„ ìë™ìœ¼ë¡œ í˜•í‰ì„± ì ìˆ˜ ê°±ì‹ 

---

## ğŸ—‚ï¸ êµ¬í˜„ íŒŒì¼ ëª©ë¡

### 1. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

#### `prisma/schema.prisma`
**ìˆ˜ì • ì‚¬í•­**:
- âœ… `WeekInfo` ëª¨ë¸ì— ìƒíƒœ ì¶”ì  í•„ë“œ ì¶”ê°€
  - `status`: 'DRAFT', 'ASSIGNING', 'COMPLETED', 'APPROVED'
  - `completedAt`, `approvedAt`, `approvedBy`

- âœ… `UnresolvedIssue` ëª¨ë¸ ì¶”ê°€ (ë¯¸í•´ê²° ì´ìŠˆ ì¶”ì )
  ```prisma
  model UnresolvedIssue {
    id         String   @id @default(cuid())
    weekInfoId String
    issueType  String   // 'SHORTAGE', 'EXCESS', 'UNFAIR', 'STAFF_SHORTAGE'
    severity   String   // 'CRITICAL', 'WARNING', 'INFO'
    staffId    String?
    category   String?
    date       DateTime? @db.Date
    message    String   @db.Text
    suggestion String?  @db.Text
    status     String   // 'PENDING_NEXT_WEEK', 'RESOLVED', 'CARRY_TO_NEXT_MONTH'
    ...
  }
  ```

- âœ… `FairnessAdjustment` ëª¨ë¸ ì¶”ê°€ (ì›”ë³„ í˜•í‰ì„± ì¡°ì •)
  ```prisma
  model FairnessAdjustment {
    id             String   @id @default(cuid())
    staffId        String
    year           Int
    month          Int
    adjustmentType String   // 'INCREASE' (ë” ë°°ì¹˜), 'REDUCE' (ëœ ë°°ì¹˜)
    adjustmentDays Int      // ì¡°ì • ì¼ìˆ˜
    reason         String   @db.Text
    status         String   // 'PENDING', 'APPLIED', 'CANCELLED'
    ...
  }
  ```

- âœ… `DailyStaffAssignment` ëª¨ë¸ (ì´ë¯¸ ì¡´ì¬)
  - ì¼ë³„ ì§ì› ë°°ì¹˜ ê¸°ë¡

**ë§ˆì´ê·¸ë ˆì´ì…˜**: `20251025091157_add_weekly_assignment_tracking`

---

### 2. í•µì‹¬ ì•Œê³ ë¦¬ì¦˜

#### `src/lib/algorithms/weekly-assign-v2.ts`
**ì£¼ê°„ ë°°ì¹˜ ë©”ì¸ ì•Œê³ ë¦¬ì¦˜** (750+ ë¼ì¸)

**ì£¼ìš” í•¨ìˆ˜**:
```typescript
export async function autoAssignWeeklySchedule(weekInfoId: string): Promise<{
  success: boolean
  message: string
  assignedCount: number
  unresolvedIssues: ValidationIssue[]
}>
```

**14ë‹¨ê³„ í”„ë¡œì„¸ìŠ¤**:

**Phase 1-3: ì¤€ë¹„ ë‹¨ê³„**
1. âœ… **í•„ìš” ì¸ì› ê³„ì‚°**: ì¹´í…Œê³ ë¦¬ë³„ ë¹„ìœ¨ì— ë”°ë¼ ì¼ë³„ í•„ìš” ì¸ì› ì‚°ì¶œ
2. âœ… **ì—°ì°¨/ì˜¤í”„ ë°˜ì˜**: í™•ì •ëœ ì—°ì°¨/ì˜¤í”„ ì§ì› ì œì™¸
3. âœ… **í˜•í‰ì„± ë‚ ì§œ ì²´í¬**: ì„¤ì • ê¸°ë°˜ìœ¼ë¡œ í˜•í‰ì„± í•„ìš” ë‚ ì§œ ì‹ë³„ ë° ìš°ì„ ìˆœìœ„ ë¶€ì—¬

**Phase 2: ìš°ì„  ë°°ì¹˜ (Step 4-5)**
4. âœ… **í˜•í‰ì„± ë‚ ì§œ ìš°ì„  ë°°ì¹˜**:
   - í˜•í‰ì„± ì ìˆ˜ê°€ ë‚®ì€ ì§ì›ë¶€í„° ë°°ì¹˜
   - ì¤‘ë³µ ë°°ì¹˜ ë°©ì§€ (ê°™ì€ ë‚ ì§œ, ì´ë²ˆ ì£¼ ë°°ì¹˜ ì—¬ë¶€ í™•ì¸)
   - ì£¼ê°„ ê·¼ë¬´ì¼ìˆ˜ ì²´í¬

5. âœ… **ê·¼ë¬´ì¼ìˆ˜ ì²´í¬**: ì „ì²´ ì§ì›ì˜ ê·¼ë¬´ì¼ìˆ˜ í˜„í™© íŒŒì•…

**Phase 3: ë³´ì¶© ë°°ì¹˜ (Step 6-7)**
6. âœ… **ë¶€ì¡± ì¸ì› ìš°ì„  ë°°ì¹˜**: ê·¼ë¬´ì¼ìˆ˜ ë¯¸ë‹¬ ì§ì› ìš°ì„  ë°°ì¹˜
7. âœ… **ë‚˜ë¨¸ì§€ ë‚ ì§œ ë°°ì¹˜**: ëª¨ë“  ìŠ¬ë¡¯ ì±„ìš°ê¸° ì‹œë„

**Phase 4: ê²€ì¦ ë° ì¡°ìœ¨ (Step 8-10)**
8. âœ… **ë°°ì¹˜ ê²€ì¦**:
   - ìŠ¬ë¡¯ ì¸ì› ê²€ì¦ (ë¶€ì¡±/ì´ˆê³¼ í™•ì¸)
   - ì§ì›ë³„ ê·¼ë¬´ì¼ìˆ˜ ê²€ì¦
   - í˜•í‰ì„± ê²€ì¦ (ì ìˆ˜ í¸ì°¨ í™•ì¸)

9. âœ… **ì¡°ìœ¨ ì‹œë„**:
   - CRITICAL ì´ìŠˆ: Flexible staffë¡œ ì¬ì‹œë„
   - WARNING/INFO ì´ìŠˆ: ì •ë‹¹ì„± í™•ì¸

10. âœ… **ê²°ê³¼ ì €ì¥**:
    - ë°°ì¹˜ ë°ì´í„° ì €ì¥
    - ë¯¸í•´ê²° ì´ìŠˆ ì €ì¥
    - ìƒíƒœ ì—…ë°ì´íŠ¸ (COMPLETED or DRAFT)
    - í˜•í‰ì„± ì ìˆ˜ ì—…ë°ì´íŠ¸

**ì£¼ìš” íŠ¹ì§•**:
- ì„¤ì • ê¸°ë°˜ í˜•í‰ì„± ì ìš© (`FairnessSettings` í™•ì¸)
- ì¤‘ë³µ ë°°ì¹˜ ë°©ì§€ (ì¼ë³„ + ì£¼ê°„ ì¶”ì )
- íŠ¸ëœì­ì…˜ ì•ˆì „ì„±
- ìƒì„¸í•œ ë¡œê¹…

---

#### `src/lib/algorithms/weekly-assign-utils.ts`
**ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ëª¨ìŒ** (500+ ë¼ì¸)

**ì£¼ìš” í•¨ìˆ˜**:

1. âœ… `calculatePriority(fairnessTypes)`: í˜•í‰ì„± ìš°ì„ ìˆœìœ„ ê³„ì‚°
   ```typescript
   // HOLIDAY(4) > HOLIDAY_ADJACENT(3) > WEEKEND(2) > NIGHT_SHIFT(1)
   ```

2. âœ… `getFairnessScore(staff, fairnessTypes)`: ì§ì›ì˜ í˜•í‰ì„± ì ìˆ˜ ì¡°íšŒ
   - ì‹ ê·œ ì§ì›ì€ ì ìˆ˜ 0 (ìµœìš°ì„  ë°°ì¹˜)

3. âœ… `saveWeeklyAssignments(...)`: ì£¼ê°„ ë°°ì¹˜ ì €ì¥
   - íŠ¸ëœì­ì…˜ìœ¼ë¡œ ì¼ê´„ ì €ì¥
   - ê¸°ì¡´ ë°°ì¹˜ ì‚­ì œ í›„ ìƒˆë¡œ ìƒì„±

4. âœ… `saveUnresolvedIssues(...)`: ë¯¸í•´ê²° ì´ìŠˆ ì €ì¥

5. âœ… `loadUnresolvedIssues(...)`: ì´ì „ ì£¼ì°¨ ì´ìŠˆ ë¡œë“œ

6. âœ… `tryFlexibleStaffAssignment(...)`: Flexible Staffë¡œ ë¶€ì¡± ì¸ì› ë³´ì¶© ì‹œë„
   - ì´ë¯¸ ë°°ì¹˜ëœ ì§ì› ì œì™¸
   - ì£¼ê°„ ê·¼ë¬´ì¼ìˆ˜ ì²´í¬

7. âœ… `tryFillStaffShortage(...)`: ê·¼ë¬´ì¼ìˆ˜ ë¶€ì¡± ì§ì› ë°°ì¹˜ ì‹œë„
   - ë‚¨ì€ ë‚ ì§œì— ìš°ì„  ë°°ì¹˜

8. âœ… `checkIfJustified(...)`: ì´ìŠˆ ì •ë‹¹ì„± í™•ì¸
   - ì¡°ìœ¨ ë¶ˆê°€ëŠ¥í•œ ì´ìŠˆ íŒë³„

9. âœ… `updateWeekStatus(...)`: ì£¼ì°¨ ìƒíƒœ ì—…ë°ì´íŠ¸

10. âœ… `getDateKey(date)`: ë‚ ì§œ í‚¤ ìƒì„± í—¬í¼

---

### 3. í˜•í‰ì„± ì ìˆ˜ ê´€ë¦¬

#### `src/lib/services/fairness-score-update-service.ts`
**í˜•í‰ì„± ì ìˆ˜ ìë™ ì—…ë°ì´íŠ¸ ì„œë¹„ìŠ¤**

**ì£¼ìš” í•¨ìˆ˜**:

1. âœ… `updateFairnessScoresAfterAssignment(weekInfoId)`:
   ```typescript
   // ì£¼ê°„ ë°°ì¹˜ ì™„ë£Œ í›„ ìë™ìœ¼ë¡œ ê° ì§ì›ì˜ í˜•í‰ì„± ì ìˆ˜ ì—…ë°ì´íŠ¸
   // - ì•¼ê°„ ê·¼ë¬´ íšŸìˆ˜
   // - ì£¼ë§ ê·¼ë¬´ íšŸìˆ˜
   // - ê³µíœ´ì¼ ê·¼ë¬´ íšŸìˆ˜
   // - ê³µíœ´ì¼ ì „í›„ ê·¼ë¬´ íšŸìˆ˜
   ```

   **ë™ì‘ ë°©ì‹**:
   - ê° DailySlotì˜ ë°°ì¹˜ ì •ë³´ ì¡°íšŒ
   - ë‚ ì§œ ìœ í˜• ë¶„ë¥˜ (`classifyDayType`)
   - í˜•í‰ì„± ì„¤ì • í™•ì¸ í›„ ì„ íƒì  ì ìš©
   - íŠ¸ëœì­ì…˜ìœ¼ë¡œ ì ìˆ˜ ì¦ë¶„ ì—…ë°ì´íŠ¸
   - ì‹ ê·œ ì§ì›ì€ FairnessScore ìë™ ìƒì„±

2. âœ… `applyMonthlyFairnessAdjustments(clinicId, year, month)`:
   ```typescript
   // ìµì›” ë°°ì¹˜ ì‹œ ì „ì›”ì˜ í˜•í‰ì„± ì¡°ì • ì‚¬í•­ ë°˜ì˜
   // - PENDING ìƒíƒœì˜ FairnessAdjustment ì ìš©
   // - APPLIED ìƒíƒœë¡œ ë³€ê²½
   ```

---

### 4. API ë¼ìš°íŠ¸

#### `src/app/api/schedule/weekly-assign/route.ts`
**ì£¼ê°„ ìë™ ë°°ì¹˜ API**

```typescript
POST /api/schedule/weekly-assign
Body: { weekInfoId: string }
```

**ê¸°ëŠ¥**:
- ì¸ì¦ í™•ì¸ (ADMIN or MANAGERë§Œ ê°€ëŠ¥)
- ì£¼ê°„ ë°°ì¹˜ ì‹¤í–‰
- ìƒì„¸ ë¡œê¹… (ì‹œì‘ ì‹œê°„, ì™„ë£Œ ì‹œê°„, ë°°ì¹˜ ì¸ì›, ì´ìŠˆ í˜„í™©)
- ë¯¸í•´ê²° ì´ìŠˆ ëª©ë¡ ë°˜í™˜

**ì‘ë‹µ ì˜ˆì‹œ**:
```json
{
  "success": true,
  "data": {
    "success": true,
    "message": "ì£¼ê°„ ë°°ì¹˜ ì™„ë£Œ: 84ëª… ë°°ì¹˜, 2ê±´ì˜ ê²½ë¯¸í•œ ì´ìŠˆ",
    "assignedCount": 84,
    "unresolvedIssues": [
      {
        "type": "STAFF_SHORTAGE",
        "severity": "WARNING",
        "staffId": "...",
        "message": "ê¹€ì² ìˆ˜ ê·¼ë¬´ì¼ìˆ˜ ë¶€ì¡±: 3/4 (ê·¼ë¬´ 2, ì—°ì°¨ 1)",
        "suggestion": "ê°€ìš© ë‚ ì§œ ì¬í™•ì¸ ë˜ëŠ” ë‹¤ìŒ ì£¼ ì¡°ì •"
      }
    ],
    "timestamp": "2025-10-25T10:30:00.000Z"
  }
}
```

---

## ğŸ”§ ê¸°ìˆ ì  ì„¸ë¶€ì‚¬í•­

### 1. ì¤‘ë³µ ë°°ì¹˜ ë°©ì§€

#### ì¼ë³„ ì¤‘ë³µ ë°©ì§€
```typescript
const assignedToday = new Set<string>()

for (const [category, required] of Object.entries(day.categoryRequirements)) {
  const availableStaff = allActiveStaff.filter(staff => {
    // ì˜¤ëŠ˜ ì´ë¯¸ ë°°ì¹˜ë¨
    if (assignedToday.has(staff.id)) return false
    // ...
  })

  toAssign.forEach(({ staff }) => {
    assignedToday.add(staff.id)  // âœ… ì¶”ì 
  })
}
```

#### ì£¼ê°„ ì¤‘ë³µ ë°©ì§€
```typescript
const weeklyAssignments = new Map<string, Set<string>>() // staffId â†’ dates

// ë°°ì¹˜ ì „ í™•ì¸
const assignedDates = weeklyAssignments.get(staff.id)
if (assignedDates?.has(dateKey)) return false

// ë°°ì¹˜ í›„ ê¸°ë¡
dates.add(dateKey)
```

### 2. í˜•í‰ì„± ì„¤ì • ê¸°ë°˜ ì ìš©

```typescript
const fairnessSettings = await prisma.fairnessSettings.findUnique({
  where: { clinicId }
})

for (const day of dailyRequirements) {
  const dayTypes = await classifyDayType(clinicId, day.date)

  day.fairnessTypes = []

  // âœ… ì„¤ì •ì— ë”°ë¼ ì„ íƒì  ì ìš©
  if (hasNightShift && fairnessSettings?.enableNightShiftFairness) {
    day.fairnessTypes.push('NIGHT_SHIFT')
  }
  if (dayTypes.includes('SATURDAY') && fairnessSettings?.enableWeekendFairness) {
    day.fairnessTypes.push('WEEKEND')
  }
  if (dayTypes.includes('HOLIDAY') && fairnessSettings?.enableHolidayFairness) {
    day.fairnessTypes.push('HOLIDAY')
  }
  if (dayTypes.includes('HOLIDAY_ADJACENT') && fairnessSettings?.enableHolidayAdjacentFairness) {
    day.fairnessTypes.push('HOLIDAY_ADJACENT')
  }
}
```

### 3. ì£¼ê°„ ê·¼ë¬´ì¼ìˆ˜ ë³´ì¥

```typescript
const staffWorkDayCount = new Map<string, StaffWorkStatus>()

// ì´ˆê¸°í™”
for (const staff of allActiveStaff) {
  const requiredDays =
    staff.workType === 'WEEK_4' ? 4 :
    staff.workType === 'WEEK_5' ? 5 :
    staff.workDays || 4  // fallback

  const leaveDays = confirmedLeaves.filter(l => l.staffId === staff.id).length

  staffWorkDayCount.set(staff.id, {
    required: requiredDays,
    current: 0,
    leave: leaveDays,
    needsMore: true
  })
}

// ë°°ì¹˜ ì „ ì²´í¬
const workStatus = staffWorkDayCount.get(staff.id)
if (workStatus) {
  const totalDays = workStatus.current + workStatus.leave
  if (totalDays >= workStatus.required) return false  // ì´ë¯¸ ì±„ì›€
}

// ë°°ì¹˜ í›„ ì¦ê°€
workStatus.current++
```

### 4. ê²€ì¦ ë° ì¡°ìœ¨

#### ê²€ì¦ í•­ëª©
1. **ìŠ¬ë¡¯ ì¸ì› ê²€ì¦**: ì¹´í…Œê³ ë¦¬ë³„ í•„ìš” ì¸ì› vs ë°°ì¹˜ ì¸ì›
2. **ê·¼ë¬´ì¼ìˆ˜ ê²€ì¦**: ì§ì›ë³„ í•„ìš”ì¼ìˆ˜ vs ì‹¤ì œ ë°°ì¹˜ì¼ìˆ˜
3. **í˜•í‰ì„± ê²€ì¦**: ê°™ì€ ë‚ ì§œ ë°°ì¹˜ëœ ì§ì›ë“¤ì˜ ì ìˆ˜ í¸ì°¨

#### ì¡°ìœ¨ ì „ëµ
- **CRITICAL ì´ìŠˆ**: Flexible Staffë¡œ ì¬ì‹œë„
- **WARNING/INFO ì´ìŠˆ**: ì •ë‹¹ì„± í™•ì¸ í›„ ì°¨ì£¼/ìµì›” ë°˜ì˜
- **ì¡°ìœ¨ ì‹¤íŒ¨**: `UnresolvedIssue`ë¡œ ê¸°ë¡

---

## ğŸ“Š ë°ì´í„° íë¦„

```
1. WeekInfo ì¡°íšŒ
   â†“
2. í•„ìš” ì¸ì› ê³„ì‚° (ì¹´í…Œê³ ë¦¬ë³„)
   â†“
3. ì—°ì°¨/ì˜¤í”„ ë°˜ì˜
   â†“
4. í˜•í‰ì„± ë‚ ì§œ ì‹ë³„ (ì„¤ì • ê¸°ë°˜)
   â†“
5. í˜•í‰ì„± ë‚ ì§œ ìš°ì„  ë°°ì¹˜
   â”œâ”€ í˜•í‰ì„± ì ìˆ˜ ì¡°íšŒ
   â”œâ”€ ì¤‘ë³µ ë°©ì§€ ì²´í¬
   â”œâ”€ ì£¼ê°„ ê·¼ë¬´ì¼ìˆ˜ ì²´í¬
   â””â”€ ë°°ì¹˜ (ë‚®ì€ ì ìˆ˜ ìš°ì„ )
   â†“
6. ê·¼ë¬´ì¼ìˆ˜ ë¶€ì¡± ì§ì› ìš°ì„  ë°°ì¹˜
   â†“
7. ë‚˜ë¨¸ì§€ ë‚ ì§œ ë°°ì¹˜
   â†“
8. ê²€ì¦
   â”œâ”€ ìŠ¬ë¡¯ ì¸ì› ê²€ì¦
   â”œâ”€ ê·¼ë¬´ì¼ìˆ˜ ê²€ì¦
   â””â”€ í˜•í‰ì„± ê²€ì¦
   â†“
9. ì¡°ìœ¨ ì‹œë„
   â”œâ”€ Flexible Staff í™œìš©
   â””â”€ ì •ë‹¹ì„± í™•ì¸
   â†“
10. ì €ì¥
    â”œâ”€ DailyStaffAssignment
    â”œâ”€ UnresolvedIssue
    â”œâ”€ WeekInfo.status
    â””â”€ FairnessScore (ìë™ ì—…ë°ì´íŠ¸)
```

---

## âœ… êµ¬í˜„ ì™„ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸

### Phase 1: Schema & Infrastructure
- [x] UnresolvedIssue ëª¨ë¸ ì¶”ê°€
- [x] FairnessAdjustment ëª¨ë¸ ì¶”ê°€
- [x] WeekInfo ìƒíƒœ í•„ë“œ ì¶”ê°€
- [x] ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„± ë° ì ìš©
- [x] Prisma Client ìƒì„±

### Phase 2: Utility Functions
- [x] calculatePriority() - í˜•í‰ì„± ìš°ì„ ìˆœìœ„ ê³„ì‚°
- [x] getFairnessScore() - ì§ì› í˜•í‰ì„± ì ìˆ˜ ì¡°íšŒ
- [x] tryFlexibleStaffAssignment() - Flexible Staff ì¬ì‹œë„
- [x] tryFillStaffShortage() - ê·¼ë¬´ì¼ìˆ˜ ë¶€ì¡± í•´ê²°
- [x] checkIfJustified() - ì´ìŠˆ ì •ë‹¹ì„± í™•ì¸
- [x] saveWeeklyAssignments() - ë°°ì¹˜ ì €ì¥
- [x] saveUnresolvedIssues() - ì´ìŠˆ ì €ì¥
- [x] loadUnresolvedIssues() - ì´ìŠˆ ë¡œë“œ
- [x] updateWeekStatus() - ìƒíƒœ ì—…ë°ì´íŠ¸

### Phase 3: Main Algorithm
- [x] autoAssignWeeklySchedule() ë©”ì¸ í•¨ìˆ˜
- [x] Phase 1-3: ì¤€ë¹„ ë‹¨ê³„ (Step 1-3)
- [x] Phase 2: ìš°ì„  ë°°ì¹˜ (Step 4-5)
- [x] Phase 3: ë³´ì¶© ë°°ì¹˜ (Step 6-7)
- [x] Phase 4: ê²€ì¦ ë° ì¡°ìœ¨ (Step 8-10)

### Phase 4: Fairness Score Update
- [x] updateFairnessScoresAfterAssignment()
- [x] applyMonthlyFairnessAdjustments()
- [x] ë°°ì¹˜ ì™„ë£Œ í›„ ìë™ í˜¸ì¶œ

### Phase 5: API Integration
- [x] POST /api/schedule/weekly-assign
- [x] ì¸ì¦ ë° ê¶Œí•œ í™•ì¸
- [x] ìƒì„¸ ë¡œê¹…
- [x] ì—ëŸ¬ í•¸ë“¤ë§

### Phase 6: Quality Assurance
- [x] TypeScript ì˜¤ë¥˜ 0ê±´
- [x] ì¤‘ë³µ ë°°ì¹˜ ë°©ì§€ ë¡œì§ ì™„ë£Œ
- [x] íŠ¸ëœì­ì…˜ ì•ˆì „ì„± í™•ë³´
- [x] í˜•í‰ì„± ì„¤ì • ë°˜ì˜ í™•ì¸

---

## ğŸ¯ í•µì‹¬ ê°œì„  ì‚¬í•­ ìš”ì•½

| í•­ëª© | ê¸°ì¡´ (v1.0) | ê°œì„  (v2.0) |
|------|-------------|-------------|
| **ë°°ì¹˜ ë‹¨ìœ„** | ì¼ë³„ ë…ë¦½ ë°°ì¹˜ | ì£¼ê°„ í†µí•© ë°°ì¹˜ |
| **ê·¼ë¬´ì¼ìˆ˜ ë³´ì¥** | âŒ ì—†ìŒ | âœ… ì£¼4ì¼/ì£¼5ì¼ ë³´ì¥ |
| **í˜•í‰ì„± ì ìš©** | ëª¨ë“  ìœ í˜• ë¬´ì¡°ê±´ ì ìš© | âœ… ì„¤ì • ê¸°ë°˜ ì„ íƒ ì ìš© |
| **ì¤‘ë³µ ë°°ì¹˜ ë°©ì§€** | âŒ ë¶ˆì™„ì „ | âœ… ì¼ë³„ + ì£¼ê°„ ì¶”ì  |
| **ê²€ì¦ í”„ë¡œì„¸ìŠ¤** | âŒ ì—†ìŒ | âœ… 3ë‹¨ê³„ ê²€ì¦ |
| **ì´ìŠˆ ì¶”ì ** | âŒ ì—†ìŒ | âœ… UnresolvedIssue ëª¨ë¸ |
| **í˜•í‰ì„± ì ìˆ˜** | âŒ ìˆ˜ë™ ì—…ë°ì´íŠ¸ | âœ… ìë™ ì—…ë°ì´íŠ¸ |
| **Flexible Staff** | ê¸°ë³¸ë§Œ ì§€ì› | âœ… ì¬ì‹œë„ ë¡œì§ ì¶”ê°€ |

---

## ğŸš€ ì‚¬ìš© ë°©ë²•

### 1. API í˜¸ì¶œ

```bash
POST /api/schedule/weekly-assign
Content-Type: application/json
Authorization: Bearer <token>

{
  "weekInfoId": "cm3..."
}
```

### 2. ì‘ë‹µ í™•ì¸

```typescript
{
  "success": true,
  "data": {
    "success": true,
    "message": "ì£¼ê°„ ë°°ì¹˜ ì™„ë£Œ: 84ëª… ë°°ì¹˜, 0ê±´ì˜ ê²½ë¯¸í•œ ì´ìŠˆ",
    "assignedCount": 84,
    "unresolvedIssues": []
  }
}
```

### 3. ë¯¸í•´ê²° ì´ìŠˆê°€ ìˆëŠ” ê²½ìš°

```typescript
{
  "success": false,  // CRITICAL ì´ìŠˆê°€ ìˆìœ¼ë©´ false
  "data": {
    "success": false,
    "message": "ì£¼ê°„ ë°°ì¹˜ ì‹¤íŒ¨: 2ê±´ì˜ ì‹¬ê°í•œ ì´ìŠˆ",
    "assignedCount": 78,
    "unresolvedIssues": [
      {
        "type": "SHORTAGE",
        "severity": "CRITICAL",
        "category": "íŒ€ì¥",
        "date": "2025-10-28",
        "message": "2025-10-28 íŒ€ì¥ ì¸ì› ë¶€ì¡±: 1/2",
        "suggestion": "Flexible staff ì¬í™•ì¸ í•„ìš”"
      }
    ]
  }
}
```

---

## ğŸ“ ì¶”í›„ ê°œì„  ê°€ëŠ¥ ì‚¬í•­

### 1. Phase 11-14 êµ¬í˜„ (ì›” ë‹¨ìœ„ ê´€ë¦¬)
í˜„ì¬ëŠ” Phase 1-10ê¹Œì§€ êµ¬í˜„ë˜ì—ˆìŠµë‹ˆë‹¤. ì¶”í›„ ë‹¤ìŒ ê¸°ëŠ¥ ì¶”ê°€ ê°€ëŠ¥:

- **Step 11**: ë‹¤ìŒ ì£¼ì°¨ ì²˜ë¦¬ (ì´ì „ ì£¼ ì´ìŠˆ ë°˜ì˜)
- **Step 12**: ì›” ì „ì²´ ê²€í† 
- **Step 13**: ë¬¸ì œì  í™•ì¸ ë° ë¶„ì„
- **Step 14**: ìµì›” í˜•í‰ì„± ì¡°ì • ìƒì„±

### 2. ëŒ€ì‹œë³´ë“œ UI
- ì£¼ê°„ ë°°ì¹˜ í˜„í™© ì‹œê°í™”
- ë¯¸í•´ê²° ì´ìŠˆ ê´€ë¦¬ í™”ë©´
- í˜•í‰ì„± ì ìˆ˜ ì°¨íŠ¸

### 3. ì•Œë¦¼ ê¸°ëŠ¥
- ë°°ì¹˜ ì™„ë£Œ ì•Œë¦¼
- CRITICAL ì´ìŠˆ ë°œìƒ ì‹œ ê´€ë¦¬ì ì•Œë¦¼

### 4. ë°°ì¹˜ ì‹œë®¬ë ˆì´ì…˜
- ì‹¤ì œ ë°°ì¹˜ ì „ ì‹œë®¬ë ˆì´ì…˜ ëª¨ë“œ
- What-if ë¶„ì„

---

## ğŸ“ ì°¸ê³  ë¬¸ì„œ

- [ë°°ì¹˜_ì‹œìŠ¤í…œ_ì™„ì „_ì¬ì„¤ê³„.md](./.claude/ë°°ì¹˜_ì‹œìŠ¤í…œ_ì™„ì „_ì¬ì„¤ê³„.md) - ì¬ì„¤ê³„ ëª…ì„¸ì„œ
- [ë°°ì¹˜_ì‹œìŠ¤í…œ_ìµœì¢…ê²€í† .md](./.claude/ë°°ì¹˜_ì‹œìŠ¤í…œ_ìµœì¢…ê²€í† .md) - ê²€í†  ë° ì˜¤ë¥˜ ìˆ˜ì • ì‚¬í•­
- [ì¸ì›ë°°ì¹˜_ì‹œìŠ¤í…œ_ì •ë¦¬.md](./.claude/ì¸ì›ë°°ì¹˜_ì‹œìŠ¤í…œ_ì •ë¦¬.md) - ê¸°ì¡´ ì‹œìŠ¤í…œ ë¶„ì„

---

## ğŸ‘¨â€ğŸ’» ê°œë°œ ì´ë ¥

**2025-10-25**
- âœ… ì¬ì„¤ê³„ì•ˆ ê²€í†  ë° ê²€ì¦ ì™„ë£Œ
- âœ… Prisma Schema ìˆ˜ì • (3ê°œ ëª¨ë¸)
- âœ… ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„± ë° ì ìš©
- âœ… ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ 10ê°œ êµ¬í˜„
- âœ… ì£¼ê°„ ë°°ì¹˜ ì•Œê³ ë¦¬ì¦˜ Phase 1-10 êµ¬í˜„ (750+ ë¼ì¸)
- âœ… í˜•í‰ì„± ì ìˆ˜ ìë™ ì—…ë°ì´íŠ¸ ì„œë¹„ìŠ¤ êµ¬í˜„
- âœ… API ë¼ìš°íŠ¸ ìƒì„±
- âœ… TypeScript ì˜¤ë¥˜ 0ê±´ ë‹¬ì„±

---

**ìƒíƒœ**: ğŸŸ¢ í”„ë¡œë•ì…˜ ì¤€ë¹„ ì™„ë£Œ
