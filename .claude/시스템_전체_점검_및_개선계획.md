# 연세바로치과 스케줄러 시스템 전체 점검 및 개선 계획

## 1. 현재 상태 분석

### 1.1 초기 설정 vs 운영 화면 비교

#### ✅ 초기 설정에서 구축한 항목들
1. **병원 정보**: 이름, 주소, 연락처
2. **부서/구분**:
   - 부서: 데스크, 진료실 (자동배치 사용 여부)
   - 구분: 팀장/실장, 고년차, 중간년차, 저년차 (우선순위, 순서)
3. **원장 정보**:
   - 구분 사용 여부
   - 구분별 약칭 설정
4. **직원 등록**:
   - 기본 정보: 이름, 생년월일
   - 소속: 부서, 구분, 직급
   - 근무 형태: 주 4일제/5일제
   - 유연성: 구분 간 유연 배치 가능 여부, 우선순위
5. **의사 조합**:
   - 조합명, 요일
   - 부서별 필요 인원
   - 구분별 상세 인원 (필요 인원, 필수 인원)
   - 야간 진료 여부
   - 구분별 비율 설정
6. **휴업일 설정**:
   - 공휴일 포함 여부
   - 정기 휴업일 (매월 N째 주 X요일)
   - 특정 날짜 지정
7. **형평성 설정**:
   - 야간 근무 형평성
   - 주말 근무 형평성
   - 공휴일 근무 형평성
   - 공휴일 인접일 형평성

#### ❌ 운영 화면에서 부족하거나 누락된 항목들

**설정 메뉴 누락 항목:**
- 부서/구분 관리 페이지 전체 부재
- 의사 조합 관리 페이지 부재 (초기 설정에서만 가능)
- 주간 패턴 관리 시스템 부재
- 형평성 설정 조회/수정 페이지 부재
- 구분별 비율 설정 페이지 부재

**직원 관리 페이지 부족 사항:**
- 목록이 단순 나열만 되고 상세 정보 부족
- 부서별/구분별 필터링 및 정렬 기능 없음
- 드래그앤드롭으로 순서 변경 불가
- 유연성 설정 조회/수정 불가
- 일괄 수정 기능 없음

**원장 설정 페이지 불명확:**
- 무엇을 설정하는지 목적이 불명확
- 구분 관리 기능 부재
- 일 패턴 연결 불명확

**연차 관리 시스템 전체 부재:**
- 직원별 개별 연차 설정 (중도 입사자)
- 기본 연차 설정 (근무 연수별)
- 연차 사용 금지 기간 설정
- 연차 잔여 현황 조회

**패턴 관리 시스템 부실:**
- 주간 패턴 조합 기능 없음
- 기존 패턴 수정 기능 부족
- 배치 로직 설정 부재 (우선순위, 제약조건 등)

**근태 관리 기능 부족:**
- QR 출퇴근 체크 외부 페이지는 있으나 URL 생성 기능 확인 필요
- 외부 기기에서 접근 가능한 독립 페이지 필요
- QR 토큰 관리 및 만료 설정 부족

## 2. 전체 개선 계획

### Phase 1: 설정 메뉴 완성도 향상 (최우선)

#### 1.1 부서/구분 관리 페이지 신규 추가
**위치**: `/settings/departments`
**기능**:
- 부서 목록 조회, 추가, 수정, 삭제
- 자동배치 사용 여부 설정
- 순서 변경 (드래그앤드롭)
- 구분 목록 조회, 추가, 수정, 삭제
- 우선순위 및 순서 설정
- 부서별 연결 (선택 사항)

#### 1.2 형평성 설정 페이지 신규 추가
**위치**: `/settings/fairness`
**기능**:
- 4가지 형평성 항목 ON/OFF
- 형평성 임계값 설정
- 형평성 계산 주기 설정
- 현재 형평성 점수 조회

#### 1.3 구분별 비율 설정 페이지 신규 추가
**위치**: `/settings/category-ratios`
**기능**:
- 구분별 배치 목표 비율 설정
- 슬라이더 UI로 직관적 조정
- 합계 100% 자동 검증
- 적용 범위 설정 (전체/부서별)

### Phase 2: 주간 패턴 관리 시스템 구축

#### 2.1 의사 조합 관리 페이지
**위치**: `/settings/combinations`
**기능**:
- 초기 설정에서 만든 조합 목록 조회
- 조합 추가/수정/삭제
- 부서별 필요 인원 조정
- 구분별 상세 인원 조정
- 필수 인원 설정
- 복사 기능

#### 2.2 주간 패턴 관리 페이지
**위치**: `/settings/weekly-patterns`
**기능**:
- 주간 단위 패턴 생성
- 7일 조합을 하나의 패턴으로 묶기
- 패턴 템플릿 저장/불러오기
- 패턴 미리보기
- 월별 패턴 할당

#### 2.3 일 패턴 수정 페이지
**위치**: `/schedule/pattern-edit`
**기능**:
- 특정 날짜의 패턴 임시 변경
- 부서별 인원 조정
- 구분별 인원 조정
- 변경 이력 관리

### Phase 3: 직원 관리 고도화

#### 3.1 직원 목록 페이지 개선
**위치**: `/settings/staff` (기존 개선)
**기능**:
- 그리드 뷰 / 카드 뷰 전환
- 상세 정보 표시 (부서, 구분, 근무형태, 유연성)
- 부서별/구분별 필터링
- 다중 정렬 (이름, 부서, 구분, 입사일)
- 드래그앤드롭 순서 변경
- 일괄 선택 및 수정
- 엑셀 내보내기/가져오기

#### 3.2 직원 상세 페이지
**위치**: `/settings/staff/[id]`
**기능**:
- 전체 정보 조회
- 정보 수정
- 유연성 설정 상세
- 근무 이력
- 연차 현황
- 형평성 점수

### Phase 4: 연차 관리 시스템 구축

#### 4.1 연차 기본 설정 페이지
**위치**: `/settings/annual-leave`
**기능**:
- 기본 연차 일수 설정 (근무 연수별)
- 월 할당 방식 (입사월 기준 / 회계연도 기준)
- 미사용 연차 이월 규칙
- 연차 촉진 설정

#### 4.2 직원별 연차 관리 페이지
**위치**: `/settings/staff-leave`
**기능**:
- 직원별 연차 개별 설정
- 중도 입사자 일할 계산
- 수동 조정 (보상 연차 등)
- 연차 사용 이력
- 잔여 연차 현황

#### 4.3 연차 사용 금지 설정
**위치**: `/settings/leave-restrictions`
**기능**:
- 기간별 금지 설정 (예: 성수기)
- 요일별 금지 설정
- 최소 근무 인원 기준 금지
- 예외 승인 프로세스

### Phase 5: 배치 로직 유연성 설정

#### 5.1 배치 알고리즘 설정 페이지
**위치**: `/settings/assignment-logic`
**기능**:
- 배치 우선순위 설정
  1. 형평성 우선
  2. 구분별 비율 우선
  3. 필수 인원 우선
  4. 혼합 모드
- 가중치 설정 (각 요소별 중요도)
- 제약 조건 설정
  - 연속 근무 일수 제한
  - 최소 휴무 간격
  - 특정 구분 연속 배제
- 배치 검증 규칙 설정

#### 5.2 배치 시뮬레이션 페이지
**위치**: `/schedule/simulation`
**기능**:
- 설정 변경 시 시뮬레이션
- 여러 시나리오 비교
- 형평성 점수 변화 예측
- 제약 위반 사항 사전 확인

### Phase 6: 근태 관리 기능 보완

#### 6.1 QR 출퇴근 외부 페이지
**위치**: `/public/attendance/[token]` (새로운 public 라우트)
**기능**:
- 인증 없이 접근 가능한 독립 페이지
- 토큰 기반 접근 제어
- 대형 QR 코드 표시
- 실시간 출퇴근 체크
- 타임스탬프 기록
- 간단한 출퇴근 현황 표시

#### 6.2 QR 토큰 관리 페이지
**위치**: `/settings/qr-tokens`
**기능**:
- QR URL 생성
- 토큰 유효기간 설정
- 토큰 갱신/폐기
- 접근 로그 조회
- 위치별 토큰 관리 (지점별)

### Phase 7: UI/UX 전반 개선

#### 7.1 목록 컴포넌트 고도화
**공통 기능**:
- 다중 정렬 (최대 3개 필드)
- 고급 필터링 (AND/OR 조건)
- 컬럼 표시/숨김 선택
- 컬럼 너비 조정
- 드래그앤드롭 순서 변경
- 페이지네이션 옵션
- 밀집도 조정 (여유/보통/밀집)

#### 7.2 폼 컴포넌트 개선
**공통 기능**:
- 단계별 폼 (긴 폼 분할)
- 자동 저장
- 변경 감지 및 확인
- 키보드 단축키
- 필드 도움말 툴팁
- 검증 실시간 피드백

#### 7.3 대시보드 고급화
**기능**:
- 위젯 추가/제거
- 위젯 크기 조정
- 위젯 배치 변경
- 개인화 레이아웃 저장
- 실시간 데이터 갱신
- 차트 인터랙션

## 3. 구현 우선순위

### 긴급 (1-2주)
1. **부서/구분 관리 페이지** - 기본 중의 기본
2. **의사 조합 관리 페이지** - 운영에 필수
3. **형평성 설정 페이지** - 핵심 기능
4. **직원 목록 개선** - 사용성 향상

### 중요 (3-4주)
5. **주간 패턴 관리 시스템** - 고급 기능
6. **연차 관리 기본 설정** - 필수 운영 기능
7. **QR 외부 페이지** - 근태 관리 완성
8. **배치 로직 설정 (기본)** - 유연성 확보

### 보통 (5-6주)
9. **일 패턴 수정 페이지** - 세부 조정
10. **직원별 연차 관리** - 상세 관리
11. **배치 시뮬레이션** - 고급 기능
12. **목록 컴포넌트 고도화** - UX 향상

### 추가 (7-8주)
13. **대시보드 고급화** - 개인화
14. **폼 컴포넌트 개선** - UX 향상
15. **연차 사용 금지 설정** - 세부 정책
16. **QR 토큰 고급 관리** - 보안 강화

## 4. 기술적 고려사항

### 4.1 컴포넌트 설계
- 공통 목록 컴포넌트 추상화
- 공통 폼 컴포넌트 추상화
- 드래그앤드롭 라이브러리 선택 (예: @dnd-kit)
- 차트 라이브러리 선택 (예: recharts)

### 4.2 데이터 구조
- 부서/구분 테이블 추가 필요
- 주간 패턴 테이블 설계
- 연차 관리 테이블 설계
- QR 토큰 테이블 설계

### 4.3 API 설계
- RESTful API 표준 준수
- 필터링/정렬 쿼리 파라미터 표준화
- 일괄 작업 API 설계
- 실시간 업데이트를 위한 WebSocket 고려

## 5. 품질 기준

### 5.1 기능 완성도
- 초기 설정의 모든 항목이 설정 메뉴에서 조회/수정 가능
- 모든 설정이 실제 배치 알고리즘에 반영
- 데이터 일관성 보장

### 5.2 사용성
- 직관적인 UI/UX
- 3클릭 이내 주요 기능 접근
- 명확한 안내 메시지 및 도움말
- 오류 상황 친절한 안내

### 5.3 전문성
- 대학교 수준의 디테일
- 실무에서 바로 사용 가능한 수준
- 다른 스케줄러와의 차별성 확보
- 고급 사용자를 위한 옵션 제공

## 6. 다음 단계

1. **Phase 1 착수**: 부서/구분 관리 페이지부터 시작
2. **데이터베이스 스키마 설계**: 부족한 테이블 추가
3. **공통 컴포넌트 개발**: 목록, 폼 등 재사용 컴포넌트
4. **단계별 구현 및 테스트**: 각 Phase별 완료 후 검증
5. **사용자 피드백 반영**: 실제 사용하면서 개선

---

**작성일**: 2025-10-26
**작성자**: Claude
**버전**: 1.0
