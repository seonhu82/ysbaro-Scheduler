# 프로젝트 문서 모순점 분석 및 해결방안

**작성일**: 2025-10-22
**분석 대상 문서**:
1. `docs/스케줄_시스템_개발_주의사항.md`
2. `docs/시스템_변경_및_기능_추가_사항_개발자용.md`
3. `docs/근태관리_시스템_개발자용_가이드.md`
4. `prisma/schema.prisma` (실제 구현)
5. `.claude/현재_구현_상태_정리.md` (작성한 현황 문서)

---

## 📋 발견된 주요 모순점

### 1. 주4일/주5일 근무 시스템 ⚠️ 중요

#### 문서 간 차이점

**A. 시스템_변경_및_기능_추가_사항_개발자용.md**:
```
- 주4일 기본, 개별적으로 주5일 설정 가능
- 주4일: 주 2일 오프, 월 8일 오프
- 주5일: 주 1일 오프, 월 4일 오프, 연차 15일
- work_type 필드 필요 ('주4일' 또는 '주5일')
```

**B. 스케줄_시스템_개발_주의사항.md**:
```python
WORK_DAYS_PER_WEEK = 4    # 주당 근무일
OFF_DAYS_PER_WEEK = 2     # 주당 오프일

# 모든 직원 주4일 고정으로 가정
# 주5일 근무자에 대한 언급 없음
```

**C. 실제 구현 (prisma/schema.prisma)**:
```prisma
model Staff {
  id                 String              @id @default(cuid())
  clinicId           String
  name               String
  rank               StaffRank           // ⚠️ work_type 필드 없음!
  pin                String
  phoneNumber        String?
  email              String?
  isActive           Boolean             @default(true)
  // ...
}

enum StaffRank {
  HYGIENIST      // 위생사
  ASSISTANT      // 어시스턴트
  COORDINATOR    // 코디네이터
  NURSE          // 간호조무사
  OTHER          // 기타
}
```

#### 모순점
1. **문서에는 work_type 필드가 필요하다고 했으나, 실제 Prisma 스키마에는 없음**
2. **주5일 근무자를 고려한 로직이 문서에만 있고 실제 구현에는 없음**

#### 해결방안

**옵션 1: 문서대로 구현 (권장)**
```prisma
enum WorkType {
  WEEK_4         // 주4일 근무
  WEEK_5         // 주5일 근무
}

model Staff {
  // ... 기존 필드들
  workType           WorkType            @default(WEEK_4)

  // 관계
  assignments        StaffAssignment[]
  leaveApplications  LeaveApplication[]
  fairnessScores     FairnessScore[]
}
```

**옵션 2: 현재 구현 유지 (모든 직원 주4일 고정)**
- 문서에서 주5일 관련 내용 제거
- 모든 직원 주 2일 오프로 통일
- 연차는 별도의 개념으로 관리 (년차에 따라)

**🎯 권장: 옵션 2**
**이유**:
- 현재 구현이 이미 주4일 기준으로 완성됨
- 시스템 단순성 유지
- 주5일 추가는 나중에 필요시 확장 가능

---

### 2. 연차/오프 시스템 개념 차이 ⚠️ 중요

#### 문서 간 차이점

**A. 시스템_변경_및_기능_추가_사항_개발자용.md**:
```
- 주5일 근무자만 연차 사용 가능 (15일)
- 주4일 근무자는 오프만 사용 (연차 없음)
- leave_type: '오프' 또는 '연차'
```

**B. 실제 구현 (prisma/schema.prisma)**:
```prisma
enum LeaveType {
  ANNUAL         // 연차
  OFF            // 오프
}

model LeaveApplication {
  // ...
  leaveType    LeaveType
  // ⚠️ 직원의 work_type을 확인하는 로직 없음
}
```

**C. 연세바로치과_기능명세서_Part2_v2.1.md**:
```
⚠️ 오프는 주 2일까지만 신청 가능합니다 (주4일제 기준)
```

#### 모순점
1. **문서: 주5일만 연차 가능**
2. **실제 구현: 모든 직원이 연차/오프 둘 다 신청 가능**
3. **work_type 필드가 없어서 검증 불가능**

#### 해결방안

**방안 1: 현재 구현대로 유지 (권장)**
```
개념 재정의:
- 오프 (OFF): 주 2일 의무 배정 (스케줄 작성 시)
- 연차 (ANNUAL): 추가 휴가 (년차에 따라 부여)

모든 직원:
- 주 2일 오프 (의무)
- 근속 연수에 따라 연차 부여 (선택적 사용)
```

**방안 2: 문서대로 구현 (복잡)**
```
주4일 직원:
- 주 2일 오프만 사용
- 연차 없음

주5일 직원:
- 주 1일 오프
- 연차 15일

⚠️ 문제점: work_type 필드 추가 필요, 로직 복잡도 증가
```

**🎯 권장: 방안 1**
**이유**:
- 현재 구현과 일치
- 개념이 명확 (오프=필수, 연차=추가)
- 복잡도 낮음

---

### 3. 슬롯 계산 로직 차이 ⚠️ 보통

#### 문서 간 차이점

**A. 스케줄_시스템_개발_주의사항.md**:
```python
# 오프 목표 계산
if has_holiday:
    # 일요일 포함: 주 1일만 오프 필요
    off_target = TOTAL_STAFF * 1  # 20자리
else:
    # 정상 주: 주 2일 오프 필요
    off_target = TOTAL_STAFF * 2  # 40자리

# 연차 가능 자리
annual_available = total_slots - off_target
```

**B. 실제 구현 (prisma/schema.prisma)**:
```prisma
model SlotLimit {
  id              String          @id @default(cuid())
  linkId          String
  link            ApplicationLink @relation(fields: [linkId], references: [id], onDelete: Cascade)
  date            DateTime  @db.Date
  dayType         DayType
  maxSlots        Int             // 최대 인원
  currentSlots    Int             @default(0)

  @@unique([linkId, date])
}

enum DayType {
  WEEKDAY        // 평일
  SATURDAY       // 토요일
}
```

#### 모순점
1. **문서: 주차 단위로 오프/연차 계산 (주 40자리 또는 20자리)**
2. **실제 구현: 날짜별 슬롯 계산 (일별 maxSlots)**
3. **주차 정보를 저장하는 테이블 없음**

#### 해결방안

**현재 구현 방식 유지 + 문서 수정**

현재 구현이 더 유연하고 실용적:
```
날짜별 슬롯 관리:
- 각 날짜마다 maxSlots 설정 가능
- 평일: 6자리, 토요일: 14자리 (원장 스케줄에 따라)
- 주차 합계는 프론트엔드에서 계산하여 표시
```

**🎯 권장: 현재 구현 유지**
**이유**:
- 더 유연한 관리 가능
- 날짜별 특수한 상황 대응 가능
- 문서의 주차 계산은 "개념" 설명용

---

### 4. 근태관리 시스템 (QR) 🆕 별도 시스템

#### 문서

**A. 근태관리_시스템_개발자용_가이드.md**:
```
QR 기반 모바일 출퇴근 체크 시스템
- QR 토큰 5분 갱신
- 디바이스 핑거프린팅
- 의심 패턴 감지
```

**B. 실제 구현 (prisma/schema.prisma)**:
```
⚠️ QR 출퇴근 관련 테이블 없음
- qr_tokens 테이블 없음
- attendance_records 테이블 없음
- device_info 테이블 없음
```

#### 해결방안

**이것은 완전히 별도의 시스템**

근태관리 가이드는 **향후 개발 예정인 별도 시스템**:
```
현재 프로젝트: 스케줄 관리 시스템
  ├── 연차/오프 신청
  ├── 스케줄 작성
  ├── 자동 배치
  └── 통계

별도 프로젝트 (Phase 4?): 근태관리 시스템
  ├── QR 출퇴근
  ├── 지각/조퇴 관리
  ├── 실시간 출근 현황
  └── 의심 패턴 감지
```

**🎯 해결: 문서 분리**
- `근태관리_시스템_개발자용_가이드.md` → `별도_프로젝트/` 폴더로 이동
- 또는 문서 제목에 "(Phase 4 예정)" 표시

---

### 5. 용어 불일치 ⚠️ 낮음

#### 발견된 용어 차이

| 문서 | 용어 1 | 용어 2 |
|------|--------|--------|
| 스케줄_주의사항.md | 자리 | 슬롯 |
| 시스템_변경사항.md | 오프 | 휴가 |
| 실제 구현 | slot | leave |
| 기능명세서 | 연차 | annual leave |

#### 해결방안

**용어 통일 권장**:
```
공식 용어:
- 슬롯 (slot) - 휴무 가능 인원 수
- 오프 (OFF) - 주 2일 의무 휴무
- 연차 (ANNUAL) - 추가 휴가
- 직원 (staff) - 스태프
- 원장 (doctor) - 닥터
```

**🎯 해결: 용어 사전 문서 작성**

---

## 📊 우선순위별 해결 계획

### 🔴 High Priority (즉시 해결 필요)

#### 1. work_type 필드 추가 여부 결정
**결론**: 추가하지 않음 (모든 직원 주4일 고정)

**Action Items**:
- [ ] Prisma 스키마 확인 (변경 불필요)
- [ ] 문서 업데이트: 주5일 관련 내용 제거 또는 "향후 확장" 표시
- [ ] `시스템_변경_및_기능_추가_사항_개발자용.md` 수정

#### 2. 연차/오프 개념 명확화
**결론**:
- 오프 (OFF) = 주 2일 의무
- 연차 (ANNUAL) = 년차에 따른 추가 휴가

**Action Items**:
- [ ] `.claude/` 폴더에 용어 정의 문서 작성
- [ ] API 응답 메시지에 개념 명확히 표시
- [ ] 신청 폼 UI에 설명 추가

---

### 🟡 Medium Priority (다음 세션에서 해결)

#### 3. 문서 구조 정리
**Action Items**:
- [ ] `근태관리_시스템_개발자용_가이드.md` → `future_features/` 폴더로 이동
- [ ] 현재 구현 vs 향후 계획 문서 분리
- [ ] README에 문서 구조 설명 추가

#### 4. 용어 통일
**Action Items**:
- [ ] 용어 사전 문서 작성 (`.claude/용어_사전.md`)
- [ ] 모든 문서에 용어 사전 링크 추가

---

### 🟢 Low Priority (시간 날 때 정리)

#### 5. 슬롯 계산 로직 문서화
**Action Items**:
- [ ] 실제 구현 기준으로 문서 재작성
- [ ] 예시 코드를 실제 TypeScript로 변경

#### 6. 코드 주석 추가
**Action Items**:
- [ ] 주요 API에 문서 링크 주석 추가
- [ ] 복잡한 로직에 설명 주석 추가

---

## 🎯 권장 해결 순서

### 1단계: 개념 정리 (30분)
```bash
# 1. 용어 사전 문서 작성
touch .claude/용어_사전.md

# 2. 시스템 개념 정리 문서 작성
touch .claude/시스템_개념_정의.md
```

### 2단계: 문서 수정 (1시간)
```bash
# 1. 시스템_변경사항 문서에서 주5일 관련 "향후 확장" 표시
# 2. 근태관리 가이드 이동 또는 제목 변경
# 3. 스케줄_주의사항에 "현재 구현" 섹션 추가
```

### 3단계: 코드 확인 (30분)
```bash
# 1. Prisma 스키마 최종 검토
# 2. API 응답 메시지 검토
# 3. 프론트엔드 UI 텍스트 검토
```

---

## 📝 요약

### 핵심 모순점 3가지

1. **work_type 필드 불일치**
   - 해결: 추가하지 않음 (주4일 고정)

2. **연차/오프 개념 불명확**
   - 해결: 오프=의무, 연차=추가로 재정의

3. **근태관리 시스템 혼재**
   - 해결: 별도 프로젝트로 분리

### 실행 계획

**오늘 할 일**:
1. ✅ 모순점 분석 완료
2. ⏳ 용어 사전 작성
3. ⏳ 시스템 개념 정의 문서 작성

**다음 세션**:
1. 문서 수정
2. 코드 주석 추가
3. README 업데이트

---

## 🤝 사용자에게 확인 필요한 사항

### 질문 1: work_type 필드
```
Q: 직원별로 주4일/주5일을 구분해야 할까요?
  A) 아니오, 모든 직원 주4일 고정 (현재 구현 유지) ✅ 권장
  B) 예, work_type 필드 추가해서 구분 필요
```

### 질문 2: 연차 개념
```
Q: 연차를 어떻게 정의할까요?
  A) 오프=주2일 의무, 연차=추가 휴가 (년차별) ✅ 권장
  B) 주5일만 연차 있음, 주4일은 연차 없음
```

### 질문 3: 근태관리 시스템
```
Q: QR 출퇴근 시스템은 언제 개발할까요?
  A) Phase 4 이후 별도 프로젝트 ✅ 권장
  B) Phase 3에 포함
  C) 개발하지 않음
```

---

**다음 단계**: 사용자 답변 받은 후 문서 수정 진행

**작성자**: Claude Code
**최종 업데이트**: 2025-10-22 16:30 KST
