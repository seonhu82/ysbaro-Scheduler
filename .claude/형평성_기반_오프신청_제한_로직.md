# í˜•í‰ì„± ê¸°ë°˜ ì˜¤í”„ ì‹ ì²­ ì œí•œ ë¡œì§

**ì‘ì„±ì¼**: 2025-10-24
**ëª©ì **: ì•¼ê°„/ì£¼ë§ ê·¼ë¬´ì˜ í˜•í‰ì„±ì„ ìœ ì§€í•˜ê¸° ìœ„í•œ ì˜¤í”„ ì‹ ì²­ ì œí•œ ì‹œìŠ¤í…œ ì„¤ê³„

---

## ğŸ“‘ ëª©ì°¨

1. [í•µì‹¬ ê°œë…](#1-í•µì‹¬-ê°œë…)
2. [í˜•í‰ì„± ì ìˆ˜ ê³„ì‚°](#2-í˜•í‰ì„±-ì ìˆ˜-ê³„ì‚°)
3. [ì˜¤í”„ ì‹ ì²­ ì œí•œ ê·œì¹™](#3-ì˜¤í”„-ì‹ ì²­-ì œí•œ-ê·œì¹™)
4. [ì‹ ì²­ í”„ë¡œì„¸ìŠ¤](#4-ì‹ ì²­-í”„ë¡œì„¸ìŠ¤)
5. [DB ì„¤ê³„](#5-db-ì„¤ê³„)
6. [êµ¬í˜„ ì˜ˆì‹œ](#6-êµ¬í˜„-ì˜ˆì‹œ)
7. [UI/UX ì„¤ê³„](#7-uiux-ì„¤ê³„)

---

# 1. í•µì‹¬ ê°œë…

## 1.1 ë¬¸ì œ ìƒí™©

**ë¬¸ì œ**: íŠ¹ì • ì§ì›ì´ ê³„ì† ì•¼ê°„/ì£¼ë§ì— ì˜¤í”„ë¥¼ ì‹ ì²­í•˜ë©´ ë‹¤ë¥¸ ì§ì›ë“¤ì´ ë¶ˆê³µí‰í•˜ê²Œ ì•¼ê°„/ì£¼ë§ ê·¼ë¬´ë¥¼ ë” ë§ì´ í•˜ê²Œ ë¨

**í•´ê²° ë°©í–¥**:
- ì•¼ê°„ ê·¼ë¬´ íšŸìˆ˜, ì£¼ë§ ê·¼ë¬´ íšŸìˆ˜ë¥¼ ì¶”ì 
- í˜•í‰ì„± ì ìˆ˜ê°€ ë‚®ì€ ì§ì›(ì•¼ê°„/ì£¼ë§ì„ ì ê²Œ í•œ ì§ì›)ì€ ì•¼ê°„/ì£¼ë§ ì˜¤í”„ ì‹ ì²­ ì œí•œ
- ì ìˆ˜ê°€ ë†’ì€ ì§ì›(ì•¼ê°„/ì£¼ë§ì„ ë§ì´ í•œ ì§ì›)ì—ê²Œ ìš°ì„ ê¶Œ ë¶€ì—¬

---

## 1.2 ê¸°ë³¸ ì›ì¹™

```
âœ… ì›ì¹™ 1: ì•¼ê°„/ì£¼ë§ ê·¼ë¬´ëŠ” ëª¨ë“  ì§ì›ì´ ê³µí‰í•˜ê²Œ ë¶„ë‹´
âœ… ì›ì¹™ 2: ë§ì´ í•œ ì‚¬ëŒì—ê²Œ ë³´ìƒ (ì˜¤í”„ ìš°ì„ ê¶Œ)
âœ… ì›ì¹™ 3: ì ê²Œ í•œ ì‚¬ëŒì€ ì œí•œ (ì¼ì • ê¸°ê°„ ì•¼ê°„/ì£¼ë§ ì˜¤í”„ ë¶ˆê°€)
âœ… ì›ì¹™ 4: íˆ¬ëª…í•œ ì•ˆë‚´ (ì™œ ì œí•œë˜ëŠ”ì§€ ì ìˆ˜ì™€ í•¨ê»˜ í‘œì‹œ)
```

---

# 2. í˜•í‰ì„± ì ìˆ˜ ê³„ì‚°

## 2.1 ì ìˆ˜ ì‚°ì • ê¸°ì¤€

### FairnessScore ëª¨ë¸ (ê¸°ì¡´)

```prisma
model FairnessScore {
  id              String   @id @default(cuid())
  staffId         String
  staff           Staff    @relation(fields: [staffId], references: [id], onDelete: Cascade)
  year            Int
  month           Int

  // ê·¼ë¬´ íšŸìˆ˜
  nightShiftCount Int      @default(0)  // ì•¼ê°„ ê·¼ë¬´ íšŸìˆ˜
  weekendCount    Int      @default(0)  // ì£¼ë§ ê·¼ë¬´ íšŸìˆ˜ (í† ìš”ì¼)
  holidayCount    Int      @default(0)  // ê³µíœ´ì¼ ê·¼ë¬´ íšŸìˆ˜

  // ì´ ì ìˆ˜ (ê°€ì¤‘ì¹˜ ì ìš©)
  totalScore      Float    @default(0)

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@unique([staffId, year, month])
}
```

### FairnessSettings ëª¨ë¸ (ê¸°ì¡´)

```prisma
model FairnessSettings {
  id                  String   @id @default(cuid())
  clinicId            String   @unique
  clinic              Clinic   @relation(fields: [clinicId], references: [id], onDelete: Cascade)

  nightShiftWeight    Float    @default(2.0)    // ì•¼ê°„ ê°€ì¤‘ì¹˜
  weekendWeight       Float    @default(1.5)    // ì£¼ë§ ê°€ì¤‘ì¹˜
  holidayWeight       Float    @default(2.0)    // ê³µíœ´ì¼ ê°€ì¤‘ì¹˜
  enableFairnessCheck Boolean  @default(true)   // í˜•í‰ì„± ì²´í¬ í™œì„±í™”
  fairnessThreshold   Float    @default(0.2)    // í˜•í‰ì„± í—ˆìš© ì˜¤ì°¨ (20%)

  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
}
```

---

## 2.2 ì ìˆ˜ ê³„ì‚° ë¡œì§

### ê³µì‹

```typescript
totalScore =
  (nightShiftCount Ã— nightShiftWeight) +
  (weekendCount Ã— weekendWeight) +
  (holidayCount Ã— holidayWeight)

// ê¸°ë³¸ ê°€ì¤‘ì¹˜ ì ìš© ì˜ˆì‹œ:
// ì•¼ê°„ 3íšŒ + ì£¼ë§ 2íšŒ + ê³µíœ´ì¼ 1íšŒ
// = (3 Ã— 2.0) + (2 Ã— 1.5) + (1 Ã— 2.0)
// = 6.0 + 3.0 + 2.0 = 11.0ì 
```

### í‰ê·  ì ìˆ˜ ê³„ì‚°

```typescript
// ì „ì²´ ì§ì› í‰ê·  ì ìˆ˜
averageScore = sum(ëª¨ë“  ì§ì›ì˜ totalScore) / ì§ì› ìˆ˜

// ì˜ˆì‹œ: 20ëª… ì§ì›, ì´ì  200ì 
// averageScore = 200 / 20 = 10.0ì 
```

### í˜•í‰ì„± íŒë‹¨ ê¸°ì¤€

```typescript
// í—ˆìš© ë²”ìœ„ ê³„ì‚° (ê¸°ë³¸ 20%)
allowedMin = averageScore Ã— (1 - fairnessThreshold)
allowedMax = averageScore Ã— (1 + fairnessThreshold)

// ì˜ˆì‹œ: í‰ê·  10.0ì , í—ˆìš© ì˜¤ì°¨ 20%
// allowedMin = 10.0 Ã— 0.8 = 8.0ì 
// allowedMax = 10.0 Ã— 1.2 = 12.0ì 

// íŒë‹¨:
// - 8.0ì  ë¯¸ë§Œ: í˜•í‰ì„± ì ìˆ˜ ë‚®ìŒ (ì œí•œ ëŒ€ìƒ)
// - 8.0~12.0ì : ì •ìƒ ë²”ìœ„
// - 12.0ì  ì´ˆê³¼: í˜•í‰ì„± ì ìˆ˜ ë†’ìŒ (ìš°ì„ ê¶Œ)
```

---

# 3. ì˜¤í”„ ì‹ ì²­ ì œí•œ ê·œì¹™

## 3.1 ì œí•œ ê¸°ì¤€

### ê¸°ì¤€ 1: ì ˆëŒ€ì  ì œí•œ (í•„ìˆ˜)

```typescript
// ì´ë²ˆ ë‹¬ í˜•í‰ì„± ì ìˆ˜ê°€ í‰ê· ë³´ë‹¤ ë‚®ìœ¼ë©´ ì œí•œ
if (myScore < averageScore Ã— 0.8) {
  // ì•¼ê°„/ì£¼ë§ ì˜¤í”„ ì‹ ì²­ ë¶ˆê°€
  return {
    canApply: false,
    reason: 'FAIRNESS_SCORE_LOW',
    message: 'ì´ë²ˆ ë‹¬ ì•¼ê°„/ì£¼ë§ ê·¼ë¬´ê°€ ë¶€ì¡±í•˜ì—¬ í•´ë‹¹ ì¼ìì— ì˜¤í”„ë¥¼ ì‹ ì²­í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.',
    myScore: myScore,
    averageScore: averageScore,
    required: averageScore Ã— 0.8
  }
}
```

### ê¸°ì¤€ 2: ìƒëŒ€ì  ì œí•œ (ì„ íƒ)

```typescript
// í•´ë‹¹ ë‚ ì§œì— ì˜¤í”„ ì‹ ì²­í•œ ì§ì›ë“¤ì˜ ì ìˆ˜ ë¹„êµ
const applicantsScores = getApplicantsScores(date);
const myRank = getRank(myScore, applicantsScores);

// ë‚´ ì ìˆ˜ê°€ í•˜ìœ„ 30%ë©´ ì œí•œ
if (myRank < 0.3) {
  return {
    canApply: false,
    reason: 'PRIORITY_LOW',
    message: 'í•´ë‹¹ ì¼ìëŠ” í˜•í‰ì„± ì ìˆ˜ê°€ ë†’ì€ ì§ì›ì—ê²Œ ìš°ì„ ê¶Œì´ ìˆìŠµë‹ˆë‹¤.',
    myScore: myScore,
    myRank: myRank
  }
}
```

### ê¸°ì¤€ 3: ì—°ì† ì˜¤í”„ ë°©ì§€

```typescript
// ì—°ì†ìœ¼ë¡œ ì•¼ê°„/ì£¼ë§ ì˜¤í”„ ì‹ ì²­ ë°©ì§€
const recentOffs = getRecentOffs(staffId, 'NIGHT_OR_WEEKEND', 30); // ìµœê·¼ 30ì¼

if (recentOffs.length >= 3) {
  return {
    canApply: false,
    reason: 'TOO_MANY_RECENT_OFFS',
    message: 'ìµœê·¼ 30ì¼ ë‚´ ì•¼ê°„/ì£¼ë§ ì˜¤í”„ê°€ 3íšŒë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤.',
    recentCount: recentOffs.length
  }
}
```

---

## 3.2 ë‚ ì§œ ìœ í˜• ë¶„ë¥˜

### ì˜¤í”„ ì‹ ì²­ ì‹œ ë‚ ì§œ ìœ í˜• íŒë‹¨

```typescript
enum DateType {
  NORMAL_WEEKDAY,    // ì¼ë°˜ í‰ì¼ (ì›”-ê¸ˆ, ì•¼ê°„ ì—†ìŒ)
  NIGHT_WEEKDAY,     // ì•¼ê°„ í‰ì¼ (ì›”-ê¸ˆ, ì•¼ê°„ ìˆìŒ)
  WEEKEND,           // ì£¼ë§ (í† ìš”ì¼)
  HOLIDAY,           // ê³µíœ´ì¼
  SUNDAY             // ì¼ìš”ì¼ (ì „ì› íœ´ë¬´)
}

function getDateType(date: Date, schedule: DoctorSchedule): DateType {
  const dayOfWeek = date.getDay();

  // ì¼ìš”ì¼
  if (dayOfWeek === 0) {
    return DateType.SUNDAY;
  }

  // ê³µíœ´ì¼ ì²´í¬
  if (isHoliday(date)) {
    return DateType.HOLIDAY;
  }

  // í† ìš”ì¼
  if (dayOfWeek === 6) {
    return DateType.WEEKEND;
  }

  // í‰ì¼ (ì•¼ê°„ ì—¬ë¶€ í™•ì¸)
  if (schedule.hasNightShift) {
    return DateType.NIGHT_WEEKDAY;
  }

  return DateType.NORMAL_WEEKDAY;
}
```

### ì œí•œ ì ìš© ê·œì¹™

| ë‚ ì§œ ìœ í˜• | í˜•í‰ì„± ì²´í¬ | ì ìˆ˜ ì˜í–¥ | ì œí•œ ì ìš© |
|----------|-----------|---------|---------|
| ì¼ë°˜ í‰ì¼ | âŒ ë¶ˆí•„ìš” | ì—†ìŒ | âŒ ì œí•œ ì—†ìŒ |
| ì•¼ê°„ í‰ì¼ | âœ… í•„ìš” | nightShift +1 | âœ… ì ìˆ˜ ë‚®ìœ¼ë©´ ì œí•œ |
| ì£¼ë§ (í† ) | âœ… í•„ìš” | weekend +1 | âœ… ì ìˆ˜ ë‚®ìœ¼ë©´ ì œí•œ |
| ê³µíœ´ì¼ | âœ… í•„ìš” | holiday +1 | âœ… ì ìˆ˜ ë‚®ìœ¼ë©´ ì œí•œ |
| ì¼ìš”ì¼ | âŒ í•´ë‹¹ì—†ìŒ | ì—†ìŒ | âŒ ì˜¤í”„ ë¶ˆê°€ (ì „ì› íœ´ë¬´) |

---

# 4. ì‹ ì²­ í”„ë¡œì„¸ìŠ¤

## 4.1 ì „ì²´ í”„ë¡œì„¸ìŠ¤

```
ì§ì›ì´ ë‚ ì§œ ì„ íƒ
     â†“
ë‚ ì§œ ìœ í˜• íŒë‹¨ (ì¼ë°˜/ì•¼ê°„/ì£¼ë§/ê³µíœ´ì¼)
     â†“
í˜•í‰ì„± ì²´í¬ í•„ìš”í•œ ë‚ ì§œì¸ê°€?
     â†“ YES
í˜„ì¬ í˜•í‰ì„± ì ìˆ˜ ì¡°íšŒ
     â†“
í‰ê·  ì ìˆ˜ì™€ ë¹„êµ
     â†“
ì œí•œ ê¸°ì¤€ ì¶©ì¡±?
     â†“ NO (ì ìˆ˜ ë‚®ìŒ)
ì œí•œ ì•ˆë‚´ ë©”ì‹œì§€ í‘œì‹œ
"ì´ë²ˆ ë‹¬ ì•¼ê°„ ê·¼ë¬´ XíšŒ, ì£¼ë§ ê·¼ë¬´ YíšŒë¡œ
 í‰ê· (ZíšŒ)ë³´ë‹¤ ì ì–´ í•´ë‹¹ ë‚ ì§œ ì˜¤í”„ ë¶ˆê°€"
     â†“
     â†“ YES (ì ìˆ˜ ì¶©ë¶„)
ì‹ ì²­ ê°€ëŠ¥ ì•ˆë‚´
"í˜•í‰ì„± ì ìˆ˜: Aì  (í‰ê·  Bì )"
     â†“
ì‹ ì²­ ì œì¶œ
```

---

## 4.2 ìƒì„¸ ê²€ì¦ ë¡œì§

### 1ë‹¨ê³„: ê¸°ë³¸ ê²€ì¦

```typescript
async function validateLeaveApplication(
  staffId: string,
  date: Date,
  leaveType: 'ANNUAL' | 'OFF'
): Promise<ValidationResult> {

  // 1. ì—°ì°¨ ì”ì—¬ í™•ì¸ (ì—°ì°¨ë§Œ)
  if (leaveType === 'ANNUAL') {
    const staff = await getStaff(staffId);
    const remaining = staff.totalAnnualDays - staff.usedAnnualDays;
    if (remaining <= 0) {
      return {
        allowed: false,
        reason: 'NO_ANNUAL_LEFT',
        message: 'ì‚¬ìš© ê°€ëŠ¥í•œ ì—°ì°¨ê°€ ì—†ìŠµë‹ˆë‹¤.'
      };
    }
  }

  // 2. ì¤‘ë³µ ì‹ ì²­ í™•ì¸
  const existing = await findExistingApplication(staffId, date);
  if (existing) {
    return {
      allowed: false,
      reason: 'DUPLICATE',
      message: 'ì´ë¯¸ í•´ë‹¹ ë‚ ì§œì— ì‹ ì²­í•˜ì…¨ìŠµë‹ˆë‹¤.'
    };
  }

  // 3. ìŠ¬ë¡¯ ì—¬ìœ  í™•ì¸
  const slotAvailable = await checkSlotAvailability(date);
  if (!slotAvailable) {
    return {
      allowed: false,
      reason: 'NO_SLOT',
      message: 'í•´ë‹¹ ë‚ ì§œëŠ” ì‹ ì²­ ê°€ëŠ¥ ì¸ì›ì´ ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤.'
    };
  }

  return { allowed: true };
}
```

### 2ë‹¨ê³„: í˜•í‰ì„± ê²€ì¦ (ì˜¤í”„ë§Œ)

```typescript
async function validateFairness(
  staffId: string,
  date: Date
): Promise<FairnessValidationResult> {

  // 1. ë‚ ì§œ ìœ í˜• íŒë‹¨
  const dateType = await getDateType(date);

  // ì¼ë°˜ í‰ì¼ì€ í˜•í‰ì„± ì²´í¬ ë¶ˆí•„ìš”
  if (dateType === DateType.NORMAL_WEEKDAY || dateType === DateType.SUNDAY) {
    return { allowed: true, requiresFairnessCheck: false };
  }

  // 2. í˜•í‰ì„± ì„¤ì • í™•ì¸
  const settings = await getFairnessSettings();
  if (!settings.enableFairnessCheck) {
    return { allowed: true, requiresFairnessCheck: false };
  }

  // 3. ì´ë²ˆ ë‹¬ ì ìˆ˜ ì¡°íšŒ
  const currentMonth = new Date();
  const myScore = await getFairnessScore(
    staffId,
    currentMonth.getFullYear(),
    currentMonth.getMonth() + 1
  );

  // 4. ì „ì²´ í‰ê·  ê³„ì‚°
  const allScores = await getAllFairnessScores(
    currentMonth.getFullYear(),
    currentMonth.getMonth() + 1
  );

  const averageScore = allScores.reduce((sum, s) => sum + s.totalScore, 0) / allScores.length;

  // 5. ìµœì†Œ ì ìˆ˜ ê¸°ì¤€
  const minRequired = averageScore * (1 - settings.fairnessThreshold);

  // 6. íŒë‹¨
  if (myScore.totalScore < minRequired) {
    return {
      allowed: false,
      requiresFairnessCheck: true,
      reason: 'FAIRNESS_SCORE_LOW',
      message: `ì´ë²ˆ ë‹¬ ${dateTypeToKorean(dateType)} ê·¼ë¬´ê°€ ë¶€ì¡±í•˜ì—¬ í•´ë‹¹ ë‚ ì§œ ì˜¤í”„ë¥¼ ì‹ ì²­í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`,
      details: {
        myScore: myScore.totalScore,
        averageScore: averageScore,
        minRequired: minRequired,
        nightShiftCount: myScore.nightShiftCount,
        weekendCount: myScore.weekendCount,
        holidayCount: myScore.holidayCount
      }
    };
  }

  return {
    allowed: true,
    requiresFairnessCheck: true,
    details: {
      myScore: myScore.totalScore,
      averageScore: averageScore,
      status: myScore.totalScore >= averageScore * 1.2 ? 'HIGH' : 'NORMAL'
    }
  };
}
```

---

# 5. DB ì„¤ê³„

## 5.1 í•„ìš”í•œ ë°ì´í„°

### í˜„ì¬ ì¡´ì¬í•˜ëŠ” í…Œì´ë¸” (í™œìš©)

1. **FairnessScore**: ì›”ë³„ ì ìˆ˜ ì €ì¥
2. **FairnessSettings**: ê°€ì¤‘ì¹˜ ë° ì„¤ì •
3. **LeaveApplication**: ì‹ ì²­ ë‚´ì—­
4. **DailySlot**: ë‚ ì§œë³„ ì›ì¥ ìŠ¤ì¼€ì¤„ (ì•¼ê°„ ì—¬ë¶€ í™•ì¸)

### ì¶”ê°€ í•„ìš”í•œ í•„ë“œ (ì„ íƒ)

```prisma
// LeaveApplication í™•ì¥ (ì„ íƒì‚¬í•­)
model LeaveApplication {
  // ... ê¸°ì¡´ í•„ë“œ

  // í˜•í‰ì„± ê´€ë ¨ ì¶”ê°€ í•„ë“œ
  fairnessScoreAtApply  Float?   // ì‹ ì²­ ë‹¹ì‹œ í˜•í‰ì„± ì ìˆ˜
  dateType              String?  // ë‚ ì§œ ìœ í˜• (NORMAL/NIGHT/WEEKEND/HOLIDAY)
  bypassFairness        Boolean  @default(false)  // ê´€ë¦¬ìê°€ í˜•í‰ì„± ë¬´ì‹œí•˜ê³  ìŠ¹ì¸
}
```

---

## 5.2 ì ìˆ˜ ì—…ë°ì´íŠ¸ ì‹œì 

### ìë™ ì—…ë°ì´íŠ¸ (ë§¤ì›” ìŠ¤ì¼€ì¤„ í™•ì • ì‹œ)

```typescript
// ìŠ¤ì¼€ì¤„ í™•ì • ì‹œ í˜¸ì¶œ
async function updateFairnessScores(year: number, month: number) {
  const schedule = await getSchedule(year, month);
  const allStaff = await getAllStaff();

  for (const staff of allStaff) {
    let nightShiftCount = 0;
    let weekendCount = 0;
    let holidayCount = 0;

    // ìŠ¤ì¼€ì¤„ì—ì„œ í•´ë‹¹ ì§ì›ì˜ ê·¼ë¬´ ë‚´ì—­ í™•ì¸
    for (const assignment of schedule.staffAssignments) {
      if (assignment.staffId !== staff.id) continue;

      const date = assignment.date;
      const dayOfWeek = date.getDay();

      // ê³µíœ´ì¼ ì²´í¬
      if (await isHoliday(date)) {
        holidayCount++;
        continue;
      }

      // ì£¼ë§ ì²´í¬ (í† ìš”ì¼)
      if (dayOfWeek === 6) {
        weekendCount++;
        continue;
      }

      // ì•¼ê°„ ê·¼ë¬´ ì²´í¬
      const doctorSchedule = await getDoctorSchedule(date);
      if (doctorSchedule.hasNightShift) {
        nightShiftCount++;
      }
    }

    // ì ìˆ˜ ê³„ì‚°
    const settings = await getFairnessSettings();
    const totalScore =
      (nightShiftCount * settings.nightShiftWeight) +
      (weekendCount * settings.weekendWeight) +
      (holidayCount * settings.holidayWeight);

    // DB ì €ì¥
    await upsertFairnessScore({
      staffId: staff.id,
      year,
      month,
      nightShiftCount,
      weekendCount,
      holidayCount,
      totalScore
    });
  }
}
```

---

# 6. êµ¬í˜„ ì˜ˆì‹œ

## 6.1 API ì—”ë“œí¬ì¸íŠ¸

### ì˜¤í”„ ì‹ ì²­ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸

```typescript
// GET /api/leave-apply/[token]/check-eligibility?staffId=xxx&date=2025-11-15

export async function GET(request: Request) {
  const { searchParams } = new URL(request.url);
  const staffId = searchParams.get('staffId');
  const date = new Date(searchParams.get('date')!);

  // 1. ê¸°ë³¸ ê²€ì¦
  const basicValidation = await validateLeaveApplication(staffId, date, 'OFF');
  if (!basicValidation.allowed) {
    return NextResponse.json({
      allowed: false,
      ...basicValidation
    });
  }

  // 2. í˜•í‰ì„± ê²€ì¦
  const fairnessValidation = await validateFairness(staffId, date);

  return NextResponse.json({
    allowed: fairnessValidation.allowed,
    requiresFairnessCheck: fairnessValidation.requiresFairnessCheck,
    ...fairnessValidation
  });
}
```

---

## 6.2 í”„ë¡ íŠ¸ì—”ë“œ ì»´í¬ë„ŒíŠ¸

### ë‚ ì§œ ì„ íƒ ì‹œ ì‹¤ì‹œê°„ ê²€ì¦

```typescript
// src/components/public-apply/DateSelector.tsx

function DateSelector({ selectedDate, onSelect, staffId }) {
  const [eligibility, setEligibility] = useState(null);

  // ë‚ ì§œ ì„ íƒ ì‹œ ì‹¤ì‹œê°„ ê²€ì¦
  useEffect(() => {
    if (!selectedDate || !staffId) return;

    checkEligibility(staffId, selectedDate).then(result => {
      setEligibility(result);
    });
  }, [selectedDate, staffId]);

  return (
    <div>
      <Calendar
        selected={selectedDate}
        onSelect={onSelect}
        modifiers={{
          restricted: (date) => !isEligible(date)
        }}
      />

      {eligibility && !eligibility.allowed && (
        <Alert variant="warning">
          <AlertTitle>ì˜¤í”„ ì‹ ì²­ ì œí•œ</AlertTitle>
          <AlertDescription>
            {eligibility.message}
            {eligibility.details && (
              <div className="mt-2 text-sm">
                <p>ë‚´ ì ìˆ˜: {eligibility.details.myScore}ì </p>
                <p>í‰ê·  ì ìˆ˜: {eligibility.details.averageScore}ì </p>
                <p>í•„ìš” ì ìˆ˜: {eligibility.details.minRequired}ì </p>
                <div className="mt-2">
                  <p>ì´ë²ˆ ë‹¬ ê·¼ë¬´:</p>
                  <p>- ì•¼ê°„: {eligibility.details.nightShiftCount}íšŒ</p>
                  <p>- ì£¼ë§: {eligibility.details.weekendCount}íšŒ</p>
                  <p>- ê³µíœ´ì¼: {eligibility.details.holidayCount}íšŒ</p>
                </div>
              </div>
            )}
          </AlertDescription>
        </Alert>
      )}

      {eligibility && eligibility.allowed && eligibility.requiresFairnessCheck && (
        <Alert variant="success">
          <AlertTitle>ì‹ ì²­ ê°€ëŠ¥</AlertTitle>
          <AlertDescription>
            í˜•í‰ì„± ì ìˆ˜: {eligibility.details.myScore}ì  (í‰ê·  {eligibility.details.averageScore}ì )
            {eligibility.details.status === 'HIGH' && (
              <p className="text-green-600 font-medium">âœ¨ ìš°ì„  ì‹ ì²­ ê°€ëŠ¥ (ì ìˆ˜ ë†’ìŒ)</p>
            )}
          </AlertDescription>
        </Alert>
      )}
    </div>
  );
}
```

---

# 7. UI/UX ì„¤ê³„

## 7.1 ì•ˆë‚´ ë©”ì‹œì§€ ì˜ˆì‹œ

### ì œí•œ ë©”ì‹œì§€ (ì ìˆ˜ ë¶€ì¡±)

```
âš ï¸ ì˜¤í”„ ì‹ ì²­ ì œí•œ

ì´ë²ˆ ë‹¬ ì•¼ê°„/ì£¼ë§ ê·¼ë¬´ê°€ ë¶€ì¡±í•˜ì—¬
í•´ë‹¹ ë‚ ì§œ(11ì›” 15ì¼ ê¸ˆìš”ì¼ ì•¼ê°„)ì— ì˜¤í”„ë¥¼ ì‹ ì²­í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

ğŸ“Š í˜•í‰ì„± ì ìˆ˜
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ë‚´ ì ìˆ˜:      6.0ì   â—€ï¸ ë¶€ì¡±
í‰ê·  ì ìˆ˜:    10.0ì 
í•„ìš” ì ìˆ˜:    8.0ì  ì´ìƒ

ğŸ“‹ ì´ë²ˆ ë‹¬ ê·¼ë¬´ í˜„í™©
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ì•¼ê°„ ê·¼ë¬´:    2íšŒ  (ê°€ì¤‘ì¹˜ 2.0)
ì£¼ë§ ê·¼ë¬´:    1íšŒ  (ê°€ì¤‘ì¹˜ 1.5)
ê³µíœ´ì¼ ê·¼ë¬´:  0íšŒ  (ê°€ì¤‘ì¹˜ 2.0)

ğŸ’¡ íŒ: ë‹¤ìŒ ë‹¬ë¶€í„°ëŠ” ì‹ ì²­ ê°€ëŠ¥í•©ë‹ˆë‹¤!
```

### ì‹ ì²­ ê°€ëŠ¥ ë©”ì‹œì§€ (ì ìˆ˜ ì¶©ë¶„)

```
âœ… ì‹ ì²­ ê°€ëŠ¥

ğŸ“Š í˜•í‰ì„± ì ìˆ˜
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ë‚´ ì ìˆ˜:      12.0ì   âœ¨ ìš°ìˆ˜
í‰ê·  ì ìˆ˜:    10.0ì 

ğŸ“‹ ì´ë²ˆ ë‹¬ ê·¼ë¬´ í˜„í™©
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ì•¼ê°„ ê·¼ë¬´:    4íšŒ
ì£¼ë§ ê·¼ë¬´:    2íšŒ
ê³µíœ´ì¼ ê·¼ë¬´:  0íšŒ

ğŸ’š ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤! ì‹ ì²­ì„ ì§„í–‰í•´ì£¼ì„¸ìš”.
```

---

## 7.2 ë‹¬ë ¥ UI í‘œì‹œ

```typescript
// ë‹¬ë ¥ì— ë‚ ì§œë³„ í‘œì‹œ
const calendarDayStyle = (date) => {
  const dateType = getDateType(date);
  const canApply = checkEligibility(date);

  if (!canApply) {
    return {
      className: 'bg-red-100 text-red-500 cursor-not-allowed',
      icon: 'ğŸš«',
      tooltip: 'í˜•í‰ì„± ì ìˆ˜ ë¶€ì¡±'
    };
  }

  if (dateType === 'NIGHT_WEEKDAY') {
    return {
      className: 'bg-purple-100',
      icon: 'ğŸŒ™',
      tooltip: 'ì•¼ê°„ ê·¼ë¬´ì¼'
    };
  }

  if (dateType === 'WEEKEND') {
    return {
      className: 'bg-blue-100',
      icon: 'ğŸ–ï¸',
      tooltip: 'ì£¼ë§'
    };
  }

  return {
    className: 'bg-white',
    icon: '',
    tooltip: ''
  };
};
```

---

## 8. ìš”ì•½

### âœ… í•µì‹¬ í¬ì¸íŠ¸

1. **í˜•í‰ì„± ì ìˆ˜ ì¶”ì **: ì•¼ê°„/ì£¼ë§/ê³µíœ´ì¼ ê·¼ë¬´ íšŸìˆ˜ë¥¼ ê°€ì¤‘ì¹˜ ì ìš©í•˜ì—¬ ì ìˆ˜í™”
2. **ì‹¤ì‹œê°„ ê²€ì¦**: ì˜¤í”„ ì‹ ì²­ ì‹œ ë‚ ì§œ ì„ íƒí•˜ìë§ˆì í˜•í‰ì„± ì²´í¬
3. **íˆ¬ëª…í•œ ì•ˆë‚´**: ì™œ ì•ˆë˜ëŠ”ì§€ ì ìˆ˜ì™€ í•¨ê»˜ ëª…í™•íˆ í‘œì‹œ
4. **ê³µì •í•œ ì œí•œ**: í‰ê·  ëŒ€ë¹„ ì¼ì • ë²”ìœ„ ë²—ì–´ë‚˜ë©´ ì œí•œ
5. **ìë™ ì—…ë°ì´íŠ¸**: ìŠ¤ì¼€ì¤„ í™•ì • ì‹œ ìë™ìœ¼ë¡œ ì ìˆ˜ ê³„ì‚°

### ğŸ“‹ êµ¬í˜„ ìˆœì„œ

1. âœ… DB ì„¤ê³„ ì™„ë£Œ (FairnessScore, FairnessSettings ì´ë¯¸ ì¡´ì¬)
2. â³ í˜•í‰ì„± ì ìˆ˜ ê³„ì‚° ë¡œì§ êµ¬í˜„
3. â³ ì˜¤í”„ ì‹ ì²­ ê²€ì¦ API êµ¬í˜„
4. â³ í”„ë¡ íŠ¸ì—”ë“œ ì‹¤ì‹œê°„ ê²€ì¦ UI êµ¬í˜„
5. â³ ì•ˆë‚´ ë©”ì‹œì§€ ë° íˆ´íŒ êµ¬í˜„

---

**ì‘ì„±ì**: Claude Code
**ìƒíƒœ**: ì„¤ê³„ ì™„ë£Œ âœ…
